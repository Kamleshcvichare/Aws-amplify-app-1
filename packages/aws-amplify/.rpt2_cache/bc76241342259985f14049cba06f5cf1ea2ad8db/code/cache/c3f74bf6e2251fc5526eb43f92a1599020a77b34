{"code":"/*\r\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\r\n * the License. A copy of the License is located at\r\n *\r\n *     http://aws.amazon.com/apache2.0/\r\n *\r\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\r\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\r\n * and limitations under the License.\r\n */\r\nimport { ConsoleLogger as Logger } from './Logger';\r\nvar logger = new Logger('Hub');\r\nvar HubClass = /** @class */ (function () {\r\n    function HubClass(name) {\r\n        this.bus = [];\r\n        this.listeners = {};\r\n        this.name = name;\r\n    }\r\n    HubClass.createHub = function (name) {\r\n        return new HubClass(name);\r\n    };\r\n    HubClass.prototype.dispatch = function (channel, payload, source) {\r\n        if (source === void 0) { source = ''; }\r\n        var capsule = {\r\n            'channel': channel,\r\n            'payload': Object.assign({}, payload),\r\n            'source': source\r\n        };\r\n        try {\r\n            this.bus.push(capsule);\r\n            this.toListeners(capsule);\r\n        }\r\n        catch (e) {\r\n            logger.warn('Hub dispatch error', e);\r\n        }\r\n    };\r\n    HubClass.prototype.listen = function (channel, listener, listenerName) {\r\n        if (listenerName === void 0) { listenerName = 'noname'; }\r\n        logger.debug(listenerName + ' listening ' + channel);\r\n        var holder = this.listeners[channel];\r\n        if (!holder) {\r\n            holder = [];\r\n            this.listeners[channel] = holder;\r\n        }\r\n        holder.push({\r\n            'name': listenerName,\r\n            'listener': listener\r\n        });\r\n    };\r\n    HubClass.prototype.toListeners = function (capsule) {\r\n        var channel = capsule.channel, payload = capsule.payload, source = capsule.source;\r\n        var holder = this.listeners[channel];\r\n        if (!holder) {\r\n            return;\r\n        }\r\n        holder.forEach(function (listener) {\r\n            try {\r\n                listener.listener.onHubCapsule(capsule);\r\n            }\r\n            catch (e) {\r\n                logger.warn('error dispatching ' + channel + ' event to ' + listener.name);\r\n            }\r\n        });\r\n        this.bus.pop();\r\n    };\r\n    return HubClass;\r\n}());\r\nexport { HubClass };\r\nvar Hub = new HubClass('__default__');\r\nexport default Hub;\r\n//# sourceMappingURL=Hub.js.map","map":"{\"version\":3,\"file\":\"Hub.js\",\"sourceRoot\":\"\",\"sources\":[\"../src/Common/Hub.ts\"],\"names\":[],\"mappings\":\"AAAA;;;;;;;;;;;GAWG;AAEH,OAAO,EAAE,aAAa,IAAI,MAAM,EAAE,MAAM,UAAU,CAAC;AAEnD,IAAM,MAAM,GAAG,IAAI,MAAM,CAAC,KAAK,CAAC,CAAC;AAEjC;IAKI,kBAAY,IAAI;QAHhB,QAAG,GAAG,EAAE,CAAC;QACT,cAAS,GAAG,EAAE,CAAC;QAGX,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;IACrB,CAAC;IAEM,kBAAS,GAAhB,UAAiB,IAAI;QACjB,MAAM,CAAC,IAAI,QAAQ,CAAC,IAAI,CAAC,CAAC;IAC9B,CAAC;IAED,2BAAQ,GAAR,UAAS,OAAO,EAAE,OAAO,EAAE,MAAS;QAAT,uBAAA,EAAA,WAAS;QAChC,IAAM,OAAO,GAAG;YACZ,SAAS,EAAE,OAAO;YAClB,SAAS,EAAE,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,OAAO,CAAC;YACrC,QAAQ,EAAE,MAAM;SACnB,CAAC;QAEF,IAAI,CAAC;YACD,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YACvB,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;QAC9B,CAAC;QAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACT,MAAM,CAAC,IAAI,CAAC,oBAAoB,EAAE,CAAC,CAAC,CAAC;QACzC,CAAC;IACL,CAAC;IAED,yBAAM,GAAN,UAAO,OAAO,EAAE,QAAQ,EAAE,YAAqB;QAArB,6BAAA,EAAA,uBAAqB;QAC3C,MAAM,CAAC,KAAK,CAAC,YAAY,GAAG,aAAa,GAAG,OAAO,CAAC,CAAC;QAErD,IAAI,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;QACrC,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;YACV,MAAM,GAAG,EAAE,CAAC;YACZ,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,GAAG,MAAM,CAAC;QACrC,CAAC;QAED,MAAM,CAAC,IAAI,CAAC;YACR,MAAM,EAAE,YAAY;YACpB,UAAU,EAAE,QAAQ;SACvB,CAAC,CAAC;IACP,CAAC;IAED,8BAAW,GAAX,UAAY,OAAO;QACP,IAAA,yBAAO,EAAE,yBAAO,EAAE,uBAAM,CAAa;QAC7C,IAAM,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;QACvC,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;YAAC,MAAM,CAAC;QAAC,CAAC;QAExB,MAAM,CAAC,OAAO,CAAC,UAAA,QAAQ;YACnB,IAAI,CAAC;gBACD,QAAQ,CAAC,QAAQ,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC;YAC5C,CAAC;YAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBACT,MAAM,CAAC,IAAI,CAAC,oBAAoB,GAAG,OAAO,GAAG,YAAY,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC;YAC/E,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC;IACnB,CAAC;IACL,eAAC;AAAD,CAAC,AA1DD,IA0DC;;AAED,IAAM,GAAG,GAAG,IAAI,QAAQ,CAAC,aAAa,CAAC,CAAC;AACxC,eAAe,GAAG,CAAC\"}"}
