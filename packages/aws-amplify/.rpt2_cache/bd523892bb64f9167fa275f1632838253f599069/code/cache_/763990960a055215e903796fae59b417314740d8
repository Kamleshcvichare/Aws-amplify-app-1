{"code":"/*\r\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\r\n * the License. A copy of the License is located at\r\n *\r\n *     http://aws.amazon.com/apache2.0/\r\n *\r\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\r\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\r\n * and limitations under the License.\r\n */\r\nimport { ConsoleLogger as Logger, } from '../../Common';\r\nvar logger = new Logger('CognitoCredentials');\r\nvar GoogleOAuth = /** @class */ (function () {\r\n    function GoogleOAuth() {\r\n    }\r\n    GoogleOAuth.prototype.refreshGoogleToken = function () {\r\n        var ga = window['gapi'] && window['gapi'].auth2 ? window['gapi'].auth2 : null;\r\n        if (!ga) {\r\n            logger.debug('no gapi auth2 available');\r\n            return Promise.reject('no gapi auth2 available');\r\n        }\r\n        return new Promise(function (res, rej) {\r\n            ga.getAuthInstance().then(function (googleAuth) {\r\n                if (!googleAuth) {\r\n                    console.log('google Auth undefiend');\r\n                    rej('google Auth undefiend');\r\n                }\r\n                var googleUser = googleAuth.currentUser.get();\r\n                // refresh the token\r\n                if (googleUser.isSignedIn()) {\r\n                    logger.debug('refreshing the google access token');\r\n                    googleUser.reloadAuthResponse()\r\n                        .then(function (authResponse) {\r\n                        var id_token = authResponse.id_token, expires_at = authResponse.expires_at;\r\n                        var profile = googleUser.getBasicProfile();\r\n                        var user = {\r\n                            email: profile.getEmail(),\r\n                            name: profile.getName()\r\n                        };\r\n                        res({ token: id_token, expires_at: expires_at });\r\n                    });\r\n                }\r\n                else {\r\n                    rej('User is not signed in with Google');\r\n                }\r\n            }).catch(function (err) {\r\n                logger.debug('Failed to refresh google token', err);\r\n                rej('Failed to refresh google token');\r\n            });\r\n        });\r\n    };\r\n    return GoogleOAuth;\r\n}());\r\nexport default GoogleOAuth;\r\n//# sourceMappingURL=GoogleOAuth.js.map","map":"{\"version\":3,\"file\":\"GoogleOAuth.js\",\"sourceRoot\":\"\",\"sources\":[\"../../src/Common/OAuthHelper/GoogleOAuth.ts\"],\"names\":[],\"mappings\":\"AAAA;;;;;;;;;;;GAWG;AACH,OAAO,EACH,aAAa,IAAI,MAAM,GAC1B,MAAM,cAAc,CAAC;AAEtB,IAAM,MAAM,GAAG,IAAI,MAAM,CAAC,oBAAoB,CAAC,CAAC;AAEhD;IAAA;IAuCA,CAAC;IAtCU,wCAAkB,GAAzB;QACI,IAAM,EAAE,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,MAAM,CAAC,MAAM,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC;QAChF,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YACN,MAAM,CAAC,KAAK,CAAC,yBAAyB,CAAC,CAAC;YACxC,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,yBAAyB,CAAC,CAAC;QACrD,CAAC;QAED,MAAM,CAAC,IAAI,OAAO,CAAC,UAAC,GAAG,EAAE,GAAG;YACxB,EAAE,CAAC,eAAe,EAAE,CAAC,IAAI,CAAC,UAAC,UAAU;gBACjC,EAAE,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;oBACd,OAAO,CAAC,GAAG,CAAC,uBAAuB,CAAC,CAAC;oBACrC,GAAG,CAAC,uBAAuB,CAAC,CAAC;gBACjC,CAAC;gBAED,IAAM,UAAU,GAAG,UAAU,CAAC,WAAW,CAAC,GAAG,EAAE,CAAC;gBAChD,oBAAoB;gBACpB,EAAE,CAAC,CAAC,UAAU,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC;oBAC1B,MAAM,CAAC,KAAK,CAAC,oCAAoC,CAAC,CAAC;oBACnD,UAAU,CAAC,kBAAkB,EAAE;yBAC1B,IAAI,CAAC,UAAC,YAAY;wBACP,IAAA,gCAAQ,EAAE,oCAAU,CAAkB;wBAC9C,IAAM,OAAO,GAAG,UAAU,CAAC,eAAe,EAAE,CAAC;wBAC7C,IAAM,IAAI,GAAG;4BACT,KAAK,EAAE,OAAO,CAAC,QAAQ,EAAE;4BACzB,IAAI,EAAE,OAAO,CAAC,OAAO,EAAE;yBAC1B,CAAC;wBAEF,GAAG,CAAC,EAAE,KAAK,EAAE,QAAQ,EAAE,UAAU,YAAA,EAAE,CAAC,CAAC;oBACzC,CAAC,CAAC,CAAC;gBACX,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACJ,GAAG,CAAC,mCAAmC,CAAC,CAAC;gBAC7C,CAAC;YACL,CAAC,CAAC,CAAC,KAAK,CAAC,UAAA,GAAG;gBACR,MAAM,CAAC,KAAK,CAAC,gCAAgC,EAAE,GAAG,CAAC,CAAC;gBACpD,GAAG,CAAC,gCAAgC,CAAC,CAAC;YAC1C,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;IACP,CAAC;IACL,kBAAC;AAAD,CAAC,AAvCD,IAuCC\"}","dts":{"name":"/Users/wezhuo/workplace/aws-amplify/packages/aws-amplify/Common/OAuthHelper/GoogleOAuth.d.ts","text":"export default class GoogleOAuth {\r\n    refreshGoogleToken(): Promise<{}>;\r\n}\r\n"}}
