{"code":"/*\r\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\r\n * the License. A copy of the License is located at\r\n *\r\n *     http://aws.amazon.com/apache2.0/\r\n *\r\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\r\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\r\n * and limitations under the License.\r\n */\r\nimport AnalyticsClass from './Analytics';\r\nimport { ConsoleLogger as Logger, Hub, AppState } from '../Common';\r\nimport Platform from '../Common/Platform';\r\nvar logger = new Logger('Analytics');\r\nvar startsessionRecorded = false;\r\nvar _instance = null;\r\nif (!_instance) {\r\n    logger.debug('Create Analytics Instance');\r\n    _instance = new AnalyticsClass();\r\n}\r\nvar Analytics = _instance;\r\nexport default Analytics;\r\nexport { AnalyticsClass };\r\n// listen on app state change\r\nvar dispatchAppStateEvent = function (event, data) {\r\n    Hub.dispatch('appState', { event: event, data: data }, 'AppState');\r\n};\r\nif (Platform.isReactNative) {\r\n    AppState.addEventListener('change', function (nextAppState) {\r\n        switch (nextAppState) {\r\n            case 'active':\r\n                dispatchAppStateEvent('active', {});\r\n        }\r\n    });\r\n}\r\nAnalytics.onHubCapsule = function (capsule) {\r\n    var channel = capsule.channel, payload = capsule.payload, source = capsule.source;\r\n    logger.debug('on hub capsule ' + channel, payload);\r\n    switch (channel) {\r\n        case 'auth':\r\n            authEvent(payload);\r\n            break;\r\n        case 'storage':\r\n            storageEvent(payload);\r\n            break;\r\n        case 'analytics':\r\n            analyticsEvent(payload);\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n};\r\nvar storageEvent = function (payload) {\r\n    var attrs = payload.attrs, metrics = payload.metrics;\r\n    if (!attrs)\r\n        return;\r\n    Analytics.record('Storage', attrs, metrics);\r\n};\r\nvar authEvent = function (payload) {\r\n    var event = payload.event;\r\n    if (!event) {\r\n        return;\r\n    }\r\n    switch (event) {\r\n        case 'signIn':\r\n            Analytics.record('_userauth.sign_in');\r\n            break;\r\n        case 'signUp':\r\n            Analytics.record('_userauth.sign_up');\r\n            break;\r\n        case 'signOut':\r\n            break;\r\n        case 'signIn_failure':\r\n            Analytics.record('_userauth.auth_fail');\r\n            break;\r\n        case 'configured':\r\n            if (!startsessionRecorded) {\r\n                startsessionRecorded = true;\r\n                Hub.dispatch('analytics', { eventType: 'session_start' }, 'Analytics');\r\n            }\r\n            break;\r\n    }\r\n};\r\nvar analyticsEvent = function (payload) {\r\n    var eventType = payload.eventType;\r\n    if (!eventType)\r\n        return;\r\n    switch (eventType) {\r\n        case 'session_start':\r\n            Analytics.startSession();\r\n            break;\r\n    }\r\n};\r\nHub.listen('auth', Analytics);\r\nHub.listen('storage', Analytics);\r\nHub.listen('analytics', Analytics);\r\n//# sourceMappingURL=index.js.map","map":"{\"version\":3,\"file\":\"index.js\",\"sourceRoot\":\"\",\"sources\":[\"../src/Analytics/index.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/wezhuo/workplace/aws-amplify/packages/aws-amplify/Analytics/index.d.ts","text":"import AnalyticsClass from './Analytics';\r\nimport { AnalyticsProvider } from './types';\r\ndeclare const Analytics: AnalyticsClass;\r\nexport default Analytics;\r\nexport { AnalyticsProvider };\r\nexport { AnalyticsClass };\r\n"}}
