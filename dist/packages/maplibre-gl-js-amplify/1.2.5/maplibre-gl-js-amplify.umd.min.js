!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@aws-amplify/core"),require("@aws-amplify/geo"),require("maplibre-gl"),require("@maplibre/maplibre-gl-geocoder")):"function"==typeof define&&define.amd?define(["exports","@aws-amplify/core","@aws-amplify/geo","maplibre-gl","@maplibre/maplibre-gl-geocoder"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).AmplifyMapLibre={},e.aws_amplify_core,e.aws_amplify_geo,e.maplibregl,e.MaplibreGeocoder)}(this,(function(e,t,o,r,i){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=n(r),a=n(i);function l(e){return Array.isArray(e)&&"number"==typeof e[0]&&"number"==typeof e[1]}function c(e){return(t=e[0])&&Array.isArray(t.coordinates)&&"number"==typeof t.coordinates[0]&&"number"==typeof t.coordinates[1];var t}const u=e=>"string"==typeof e&&e.length>0,d=e=>{let t;return t=l(e[0])?e.map((e=>({type:"Feature",geometry:{type:"Point",coordinates:e},properties:{place_name:`Coordinates,${e}`}}))):c(e)?e.map((e=>({type:"Feature",geometry:{type:"Point",coordinates:e.coordinates},properties:{title:e.title,address:e.address}}))):e,t};var p=function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{l(r.next(e))}catch(e){n(e)}}function a(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}l((r=r.apply(e,t||[])).next())}))},y=function(e,t){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(o[r[i]]=e[r[i]])}return o};class f{constructor(e,o){this.refreshCredentials=()=>p(this,void 0,void 0,(function*(){try{this.credentials=yield t.Amplify.Auth.currentCredentials()}catch(e){throw console.error(`Failed to refresh credentials: ${e}`),e}})),this.refreshCredentialsWithRetry=()=>p(this,void 0,void 0,(function*(){try{const e=3e5;yield t.jitteredExponentialRetry(this.refreshCredentials,[],e),this.activeTimeout&&clearTimeout(this.activeTimeout);const o=new Date(this.credentials.expiration).getTime()-(new Date).getTime()-1e4;this.activeTimeout=window.setTimeout(this.refreshCredentialsWithRetry,o)}catch(e){console.error(`Failed to refresh credentials: ${e}`)}})),this.transformRequest=(e,o)=>{if("Style"===o&&!e.includes("://")){if(null==this.region)throw new Error("AWS region for map is undefined. Please verify that the region is set in aws-exports.js or that you are providing an AWS region parameter to createMap");e=`https://maps.geo.${this.region}.amazonaws.com/maps/v0/maps/${e}/style-descriptor`}if(e.includes("amazonaws.com")){const o=e+`?x-amz-user-agent=${encodeURIComponent((r=t.getAmplifyUserAgent(),r.replace(/\./g,"%2E")))}`;return{url:t.Signer.signUrl(o,{access_key:this.credentials.accessKeyId,secret_key:this.credentials.secretAccessKey,session_token:this.credentials.sessionToken})}}var r},this.credentials=e,this.region=o,this.activeTimeout=null,this.refreshCredentialsWithRetry(),t.Hub.listen("auth",(e=>{switch(e.payload.event){case"signIn":case"signOut":case"tokenRefresh":this.refreshCredentialsWithRetry()}}))}}f.createMapLibreMap=e=>p(void 0,void 0,void 0,(function*(){const{region:i,mapConstructor:n=r.Map}=e,s=y(e,["region","mapConstructor"]),a=o.Geo.getDefaultMap(),l=new f(yield t.Amplify.Auth.currentCredentials(),i||a.region).transformRequest;return new n(Object.assign(Object.assign({},s),{style:e.style||a.mapName,transformRequest:l}))}));const m="#fff",h="#000",g="#5d8aff",b="M24.8133 38.533C18.76 31.493 13 28.8264 13 20.8264C13.4827 14.9864 16.552 9.67169 21.368 6.33302C33.768 -2.26165 50.824 5.78902 52.0667 20.8264C52.0667 28.613 46.5733 31.6797 40.6533 38.373C32.4933 47.5464 35.4 63.093 32.4933 63.093C29.72 63.093 32.4933 47.5464 24.8133 38.533ZM32.4933 8.23969C26.5573 8.23969 21.7467 13.0504 21.7467 18.9864C21.7467 24.9224 26.5573 29.733 32.4933 29.733C38.4293 29.733 43.24 24.9224 43.24 18.9864C43.24 13.0504 38.4293 8.23969 32.4933 8.23969Z";var v;!function(e){e.ESRI_TOPOGRAPHIC="VectorEsriTopographic",e.ESRI_STREETS="VectorEsriStreets",e.ESRI_LIGHT_GRAY="VectorEsriLightGrayCanvas",e.ESRI_DARK_GRAY="VectorEsriDarkGrayCanvas",e.ESRI_NAVIGATION="VectorEsriNavigation",e.HERE_BERLIN="VectorHereBerlin"}(v||(v={}));const w={[v.ESRI_TOPOGRAPHIC]:"Noto Sans Regular",[v.ESRI_STREETS]:"Arial Regular",[v.ESRI_LIGHT_GRAY]:"Ubuntu Regular",[v.ESRI_DARK_GRAY]:"Ubuntu Regular",[v.ESRI_NAVIGATION]:"Arial Regular",[v.HERE_BERLIN]:"Fira GO Regular"};function C(e){const t=(null==e?void 0:e.fillColor)?e.fillColor:g,o=(null==e?void 0:e.strokeColor)?e.strokeColor:m,r=(null==e?void 0:e.lineWidth)?e.lineWidth:4;return{width:64,height:64,data:new Uint8Array(16384),onAdd:function(){const e=document.createElement("canvas");e.width=this.width,e.height=this.height,this.context=e.getContext("2d")},render:function(){const e=this.context,i=new Path2D(b);return e.stroke(i),e.fillStyle=t,e.strokeStyle=o,e.lineWidth=r,e.fill(i),this.data=e.getImageData(0,0,this.width,this.height).data,!0}}}var x=function(e,t){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(o[r[i]]=e[r[i]])}return o};const R="amplify-tip";function O(e,t,o){var{showMarkerPopup:i=!1}=o,n=x(o,["showMarkerPopup"]);const s=`${e}-layer-unclustered-point`;let a=null;function c(){null!==a&&(t.setLayoutProperty(s,"icon-image","inactive-marker"),a=null)}const d=n.popupRender?n.popupRender:function(e,{popupBackgroundColor:t="#fff",popupBorderColor:o="#0000001f",popupBorderWidth:r=2,popupFontColor:i="#000",popupPadding:n=20,popupBorderRadius:s=4,popupTitleFontWeight:a="bold"}){return l=>{let c,d;if(u(l.properties.place_name)){const e=l.properties.place_name.split(",");c=e[0],d=e.splice(1,e.length).join(",")}else u(l.properties.title)||u(l.properties.address)?(c=l.properties.title,d=l.properties.address):(c="Coordinates",d=l.geometry.coordinates);let p=`<div class="${e}-popup" style="background: ${t}; border: ${r}px solid ${o}; color: ${i}; border-radius: ${s}px; padding: ${n}px; word-wrap: break-word; margin: -10px -10px -15px;">`;return c&&(p+=`<div class="${e}-popup-title" style="font-weight: ${a};">${c}</div>`),d&&(p+=`<div class="${e}-popup-address">${d}</div>`),p+="</div>",p}}(s,n);!function(e,{selectedColor:t="#ff9900",selectedBorderColor:o="#fff",selectedBorderWidth:r=4,defaultBorderColor:i="#fff",defaultBorderWidth:n=4,defaultColor:s="#5d8aff",markerImageElement:a,activeMarkerImageElement:l}){const c=a||C({fillColor:s,strokeColor:i,lineWidth:n}),u=l||a||C({fillColor:t,strokeColor:o,lineWidth:r});e.addImage("inactive-marker",c,{pixelRatio:2}),e.addImage("active-marker",u,{pixelRatio:2})}(t,n);const p={id:s,type:"symbol",source:e,filter:["!",["has","point_count"]],layout:{"icon-image":"inactive-marker"}};if(t.addLayer(Object.assign({},p)),i){if(!document.getElementById(R)){const e=document.createElement("style");e.setAttribute("id",R),document.head.append(e),e.textContent=".mapboxgl-popup-tip { display: none; }"}}return t.on("click",(function(){c()})),t.on("click",s,(function(e){if("function"==typeof n.onClick&&n.onClick(e),a=e.features[0].id,t.setLayoutProperty(s,"icon-image",["match",["id"],a,"active-marker","inactive-marker"]),i){const o=e.features[0],i=o.geometry.coordinates;if(l(i)){(new r.Popup).setLngLat(i).setHTML(d(o)).setOffset(15).addTo(t).on("close",(function(){a===o.id&&c()}))}}})),t.on("mouseover",s,(function(){t.getCanvas().style.cursor="pointer"})),t.on("mouseleave",s,(()=>{t.getCanvas().style.cursor=""})),{unclusteredLayerId:s}}function I(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg"),t=document.createElementNS("http://www.w3.org/2000/svg","path"),o=document.createElement("circle");return e.setAttribute("viewBox","0 0 64 64"),e.setAttribute("width","32"),e.setAttribute("height","32"),t.setAttribute("d",b),t.setAttribute("fill","#5d8aff"),o.setAttribute("fill","white"),o.setAttribute("cx","50%"),o.setAttribute("cy","50%"),o.setAttribute("r","5"),e.appendChild(o),e.appendChild(t),e}var A=function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{l(r.next(e))}catch(e){n(e)}}function a(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}l((r=r.apply(e,t||[])).next())}))},P=function(e,t){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(o[r[i]]=e[r[i]])}return o};const S={forwardGeocode:e=>A(void 0,void 0,void 0,(function*(){const t=[];try{const r=yield o.Geo.searchByText(e.query,{biasPosition:e.bbox?void 0:e.proximity,searchAreaConstraints:e.bbox,countries:e.countries,maxResults:e.limit});r&&r.forEach((e=>{const{geometry:o}=e,r=P(e,["geometry"]);t.push({type:"Feature",geometry:{type:"Point",coordinates:o.point},properties:Object.assign({},r),place_name:r.label,text:r.label,center:o.point})}))}catch(e){console.error(`Failed to forwardGeocode with error: ${e}`)}return{features:t}})),reverseGeocode:e=>A(void 0,void 0,void 0,(function*(){const t=[];try{const r=yield o.Geo.searchByCoordinates(e.query,{maxResults:e.limit});if(r&&r.geometry){const{geometry:e}=r,o=P(r,["geometry"]);t.push({type:"Feature",geometry:{type:"Point",coordinates:e.point},properties:Object.assign({},o),place_name:o.label,text:o.label,center:e.point})}}catch(e){console.error(`Failed to reverseGeocode with error: ${e}`)}return{features:t}})),getSuggestions:e=>A(void 0,void 0,void 0,(function*(){const t=[];try{const r=yield o.Geo.searchForSuggestions(e.query,{biasPosition:e.bbox?void 0:e.proximity,searchAreaConstraints:e.bbox,countries:e.countries,maxResults:e.limit});t.push(...r)}catch(e){console.error(`Failed to get suggestions with error: ${e}`)}return{suggestions:t}}))};const E=e=>e.map((e=>{var t;return{type:"Feature",geometry:{type:"Polygon",coordinates:(t=e)&&"string"==typeof t.id&&"object"==typeof t.geometry?e.geometry.polygon:e},properties:{}}}));e.AmplifyGeocoderAPI=S,e.AmplifyMapLibreRequest=f,e.createAmplifyGeocoder=function(e){return new a.default(S,Object.assign({maplibregl:s.default,showResultMarkers:{element:I()},marker:{element:I()},showResultsWhileTyping:null==e?void 0:e.autocomplete},e))},e.createDefaultIcon=I,e.createMap=e=>p(void 0,void 0,void 0,(function*(){return f.createMapLibreMap(e)})),e.drawGeofences=function(e,t,o,r={}){var i,n,s,a,l;if(!o||"function"!=typeof o.addSource||"function"!=typeof o.addLayer)throw new Error("Please use a maplibre map");const c=E(t),u=`${e}-source`;o.addSource(u,{type:"geojson",data:{type:"FeatureCollection",features:c},generateId:!0});const d=`${e}-fill-layer`;o.addLayer({id:d,type:"fill",source:u,layout:{visibility:"visible"},paint:{"fill-color":null!==(i=r.fillColor)&&void 0!==i?i:h,"fill-opacity":null!==(n=r.fillOpacity)&&void 0!==n?n:.3}});const p=`${e}-outline-layer`;return o.addLayer({id:p,type:"line",source:u,layout:{visibility:"visible"},paint:{"line-color":null!==(s=r.borderColor)&&void 0!==s?s:h,"line-opacity":null!==(a=r.borderOpacity)&&void 0!==a?a:.5,"line-width":null!==(l=r.borderWidth)&&void 0!==l?l:4}}),{sourceId:u,outlineLayerId:p,fillLayerId:d,show:()=>{o.setLayoutProperty(d,"visibility","visible"),o.setLayoutProperty(p,"visibility","visible")},hide:()=>{o.setLayoutProperty(d,"visibility","none"),o.setLayoutProperty(p,"visibility","none")}}},e.drawPoints=function(e,t,r,{showCluster:i=!0,clusterOptions:n={},unclusteredOptions:s={},autoFit:a=!0}={},l){var c,u;if(!r||"function"!=typeof r.addSource||"function"!=typeof r.addLayer)throw new Error("Please use a maplibre map");const p=d(t),y=e;let f,m;r.addSource(y,{type:"geojson",data:{type:"FeatureCollection",features:p},cluster:i,clusterMaxZoom:null!==(c=n.clusterMaxZoom)&&void 0!==c?c:14,clusterRadius:null!==(u=n.smCircleSize)&&void 0!==u?u:60,generateId:!0}),i&&({clusterLayerId:f,clusterSymbolLayerId:m}=function(e,t,{fillColor:r="#5d8aff",smCircleSize:i=60,smThreshold:n=50,mdCircleSize:s=100,mdThreshold:a=100,lgCircleSize:l=140,lgThreshold:c=500,xlCircleSize:u=180,borderWidth:d=4,borderColor:p="#fff",clusterPaint:y,onClick:f,showCount:m,clusterCountLayout:h,fontColor:g="#fff"},b){const v=`${e}-layer-clusters`,C=`${e}-layer-cluster-count`,x=Object.assign({"circle-color":["step",["get","point_count"],r,n,r,a,r,c,r],"circle-radius":["step",["get","point_count"],i,n,s,a,l,c,u],"circle-stroke-width":d,"circle-stroke-color":p},y),R={id:v,type:"circle",source:e,filter:["has","point_count"],paint:x};if(t.addLayer(Object.assign({},R)),t.on("click",v,(function(o){"function"==typeof f&&f(o);const r=t.queryRenderedFeatures(o.point,{layers:[v]}),i=r[0].properties.cluster_id,n=t.getSource(e);(function(e){return"geojson"===e.type})(n)&&n.getClusterExpansionZoom(i,(function(e,o){e||t.easeTo({center:r[0].geometry.coordinates,zoom:o})}))})),m){const r={"text-field":"{point_count_abbreviated}","text-size":24},i=b||o.Geo.getDefaultMap().style;i&&(r["text-font"]=[w[i]]);const n=Object.assign(Object.assign({},r),h),s={id:C,type:"symbol",source:e,filter:["has","point_count"],layout:n,paint:{"text-color":g}};t.addLayer(Object.assign({},s))}return{clusterLayerId:v,clusterSymbolLayerId:C}}(y,r,n,l));const{unclusteredLayerId:h}=O(y,r,s||{});if(a){const e=r.getBounds();p.forEach((function(t){e.extend(t.geometry.coordinates)})),r.fitBounds(e)}return{sourceId:y,unclusteredLayerId:h,clusterLayerId:f,clusterSymbolLayerId:m,setData:e=>{const t=d(e);r.getSource(y).setData({type:"FeatureCollection",features:t})},show:()=>{r.setLayoutProperty(h,"visibility","visible"),f&&r.setLayoutProperty(f,"visibility","visible"),m&&r.setLayoutProperty(m,"visibility","visible")},hide:()=>{r.setLayoutProperty(h,"visibility","none"),f&&r.setLayoutProperty(f,"visibility","none"),m&&r.setLayoutProperty(m,"visibility","none")}}},Object.defineProperty(e,"__esModule",{value:!0})}));