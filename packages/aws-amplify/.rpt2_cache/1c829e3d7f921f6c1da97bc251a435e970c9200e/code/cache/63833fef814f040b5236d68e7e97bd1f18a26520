{"code":"import * as tslib_1 from \"tslib\";\r\n/*\r\n * Copyright 2017-2018 Amazon.com, Inc. or its affiliates. All Rights Reserved.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\r\n * the License. A copy of the License is located at\r\n *\r\n *     http://aws.amazon.com/apache2.0/\r\n *\r\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\r\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\r\n * and limitations under the License.\r\n */\r\nimport '../Common/Polyfills';\r\nimport * as Observable from 'zen-observable';\r\nimport { ConsoleLogger as Logger } from '../Common/Logger';\r\nimport { AWSAppSyncProvider } from './Providers';\r\nvar logger = new Logger('PubSub');\r\nvar PubSub = /** @class */ (function () {\r\n    /**\r\n     * Initialize PubSub with AWS configurations\r\n     *\r\n     * @param {PubSubOptions} options - Configuration object for PubSub\r\n     */\r\n    function PubSub(options) {\r\n        this._options = options;\r\n        logger.debug('PubSub Options', this._options);\r\n        this._pluggables = [];\r\n    }\r\n    /**\r\n     * Configure PubSub part with configurations\r\n     *\r\n     * @param {PubSubOptions} config - Configuration for PubSub\r\n     * @return {Object} - The current configuration\r\n     */\r\n    PubSub.prototype.configure = function (options) {\r\n        var _this = this;\r\n        var opt = options ? options.PubSub || options : {};\r\n        logger.debug('configure PubSub', { opt: opt });\r\n        this._options = Object.assign({}, this._options, opt);\r\n        if (this._options.aws_appsync_graphqlEndpoint && this._options.aws_appsync_region &&\r\n            !this._pluggables.find(function (p) { return p.getProviderName() === 'AWSAppSyncProvider'; })) {\r\n            this.addPluggable(new AWSAppSyncProvider());\r\n        }\r\n        this._pluggables.map(function (pluggable) { return pluggable.configure(_this._options); });\r\n        return this._options;\r\n    };\r\n    /**\r\n     * add plugin into Analytics category\r\n     * @param {Object} pluggable - an instance of the plugin\r\n     */\r\n    PubSub.prototype.addPluggable = function (pluggable) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var config;\r\n            return tslib_1.__generator(this, function (_a) {\r\n                if (pluggable) {\r\n                    this._pluggables.push(pluggable);\r\n                    config = pluggable.configure(this._options);\r\n                    return [2 /*return*/, config];\r\n                }\r\n                return [2 /*return*/];\r\n            });\r\n        });\r\n    };\r\n    PubSub.prototype.publish = function (topics, msg, options) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            return tslib_1.__generator(this, function (_a) {\r\n                return [2 /*return*/, this._pluggables.map(function (provider) { return provider.publish(topics, msg, options); })];\r\n            });\r\n        });\r\n    };\r\n    PubSub.prototype.subscribe = function (topics, options) {\r\n        var _this = this;\r\n        logger.debug('subscribe options', options);\r\n        return new Observable(function (observer) {\r\n            var observables = _this._pluggables.map(function (provider) { return ({\r\n                provider: provider,\r\n                observable: provider.subscribe(topics, options),\r\n            }); });\r\n            var subscriptions = observables.map(function (_a) {\r\n                var provider = _a.provider, observable = _a.observable;\r\n                return observable.subscribe({\r\n                    start: console.error,\r\n                    next: function (value) { return observer.next({ provider: provider, value: value }); },\r\n                    error: function (error) { return observer.error({ provider: provider, error: error }); },\r\n                });\r\n            });\r\n            return function () { return subscriptions.forEach(function (subscription) { return subscription.unsubscribe(); }); };\r\n        });\r\n    };\r\n    return PubSub;\r\n}());\r\nexport default PubSub;\r\n//# sourceMappingURL=PubSub.js.map","map":"{\"version\":3,\"file\":\"PubSub.js\",\"sourceRoot\":\"\",\"sources\":[\"../src/PubSub/PubSub.ts\"],\"names\":[],\"mappings\":\"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\"}"}
